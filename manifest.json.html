<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sourav Surfers</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#ff6666">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
body{
  margin:0;
  background:#111;
  color:white;
  font-family:Arial, sans-serif;
  overflow:hidden;
}
#game{
  position:relative;
  width:100vw;
  height:100vh;
  background:#1b1b1b;
  overflow:hidden;
}
.track{
  position:absolute;
  width:33.33%;
  height:100%;
  border-left:2px dashed #444;
}
.track:nth-child(1){left:0}
.track:nth-child(2){left:33.33%}
.track:nth-child(3){left:66.66%}

#player,#powerAvatar{
  position:absolute;
  bottom:80px;
  font-size:42px;
  transition:0.12s;
}
.item{
  position:absolute;
  font-size:30px;
}
#hud{
  position:absolute;
  top:10px;
  left:10px;
  z-index:5;
  font-size:14px;
}
#menu{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:999;
}
button{
  padding:12px 22px;
  margin:6px;
  font-size:16px;
  cursor:pointer;
}
.hidden{display:none}

/* Install Banner */
#installBanner{
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  background:#ff6666;
  padding:12px 20px;
  border-radius:10px;
  display:none;
  z-index:1000;
  color:white;
  font-weight:bold;
}
#installBanner button{
  margin-left:10px;
  padding:6px 12px;
  border:none;
  border-radius:5px;
  cursor:pointer;
  font-weight:bold;
}
</style>
</head>

<body>

<div id="game">
  <div class="track"></div>
  <div class="track"></div>
  <div class="track"></div>

  <div id="player">ðŸ˜€</div>
  <div id="powerAvatar" class="hidden"></div>

  <div id="hud">
    Coins: <span id="coinText">0</span><br>
    Power: <span id="powerText">None</span>
  </div>

  <div id="menu">
    <h1>Sourav Surfers</h1>
    <p style="text-align:center">
      Creator: <b>Sourav Shan K</b><br>
      Helped by <b>ChatGPT</b>
    </p>
    <button onclick="startGame()">Start Game</button>
    <button onclick="openStore()">Store</button>
    <button onclick="redeemCode()">Redeem Code</button>
  </div>

  <div id="installBanner">
    Install Sourav Surfers!
    <button id="installBtn">Install</button>
  </div>
</div>

<script>
/* ======= GAME STATE ======= */
let gameState = "menu"; // "menu" | "playing"
let running = false;
let lane = 1, y = 80, vy = 0, jumping = false;
let items = [];
let coins = Number(localStorage.coins)||0;
let usedCode = localStorage.usedCode==="1";

/* powerups */
let magnet = false, jetpack = false, doubleMoney = false;
let powerTimer = 0;

/* elements */
const player = document.getElementById("player");
const avatar = document.getElementById("powerAvatar");
const menu = document.getElementById("menu");
const coinText = document.getElementById("coinText");
const powerText = document.getElementById("powerText");
coinText.innerText = coins;

/* ======= PWA INSTALL ======= */
let deferredPrompt;
let installPromptShown = false;

window.addEventListener("beforeinstallprompt", e=>{
  e.preventDefault();
  deferredPrompt = e;
});

/* ======= START GAME ======= */
function startGame(){
  gameState = "playing";
  running = true;

  menu.style.display = "none";

  lane = 1; y = 80; vy = 0; jumping = false;
  magnet = jetpack = doubleMoney = false;
  powerTimer = 0;
  powerText.innerText = "None";
  player.classList.remove("hidden");
  avatar.classList.add("hidden");

  items.forEach(it=>it.el.remove());
  items=[];

  requestAnimationFrame(gameLoop);
  spawnLoop();

  startInstallTimer(); // start 2-min timer
}

/* ======= STORE ======= */
function openStore(){
  let choice=prompt(
    "STORE\nhover = Hoverboard (300)\ncool = ðŸ˜Ž Cool Dude (5000)\nrobot = ðŸ¤– Robot (15000)"
  );
  if(!choice) return;

  if(choice==="hover" && coins>=300){coins-=300; alert("Hoverboard bought")}
  if(choice==="cool" && coins>=5000){coins-=5000; player.innerText="ðŸ˜Ž"}
  if(choice==="robot" && coins>=15000){coins-=15000; player.innerText="ðŸ¤–"}

  localStorage.coins=coins;
  coinText.innerText=coins;
}

/* ======= REDEEM ======= */
function redeemCode(){
  if(usedCode){alert("Code already used"); return;}
  let c=prompt("Enter code:");
  if(c==="SOM"){
    coins+=100000;
    usedCode=true;
    localStorage.usedCode="1";
    localStorage.coins=coins;
    coinText.innerText=coins;
    alert("100000 coins added!");
  }else alert("Invalid code");
}

/* ======= CONTROLS ======= */
document.addEventListener("keydown",e=>{
  if(gameState!=="playing") return;
  if(e.key==="ArrowLeft" && lane>0) lane--;
  if(e.key==="ArrowRight" && lane<2) lane++;
  if(e.key==="ArrowUp" && !jumping){vy=16; jumping=true;}
  updatePlayer();
});

function updatePlayer(){
  let x = lane*33.33 + 16;
  player.style.left = x + "%";
  player.style.bottom = y + "px";
  avatar.style.left = player.style.left;
  avatar.style.bottom = player.style.bottom;
}

/* ======= GAME LOOP ======= */
function gameLoop(){
  if(gameState!=="playing") return;

  vy -= 0.8;
  y += vy;
  if(y<=80){y=80; vy=0; jumping=false;}
  updatePlayer();

  if(powerTimer>0){
    powerTimer--;
    powerText.innerText = Math.ceil(powerTimer/60);
    if(powerTimer===0){
      magnet = jetpack = doubleMoney = false;
      avatar.classList.add("hidden");
      player.classList.remove("hidden");
      powerText.innerText="None";
    }
  }

  items.forEach((it,i)=>{
    it.y-=6;
    it.el.style.bottom = it.y + "px";

    if(magnet && it.type==="coin"){
      it.lane = lane;
      it.el.style.left=(lane*33.33+16)+"%";
    }

    if(it.y<120 && it.lane===lane){
      if(it.type==="coin"){
        coins+=doubleMoney?2:1;
        coinText.innerText=coins;
        localStorage.coins=coins;
        it.el.remove(); items.splice(i,1);
      }
      if(it.type==="power"){
        activatePower(it.power,it.emoji);
        it.el.remove(); items.splice(i,1);
      }
      if(it.type==="train" && !jetpack){
        gameOver();
      }
    }
    if(it.y<0){it.el.remove(); items.splice(i,1);}
  });

  requestAnimationFrame(gameLoop);
}

/* ======= GAME OVER ======= */
function gameOver(){
  gameState="menu";
  running=false;
  menu.style.display="flex";
}

/* ======= SPAWN ======= */
function spawnLoop(){
  if(gameState!=="playing") return;

  let r=Math.random();
  let l=Math.floor(Math.random()*3);

  if(r<0.5) spawn("coin","ðŸª™",l);
  if(r>0.8){
    let p=Math.random();
    if(p<0.33) spawn("power","ðŸ§²",l,"magnet");
    else if(p<0.66) spawn("power","ðŸš€",l,"jetpack");
    else spawn("power","ðŸ’°",l,"double");
  }
  if(r>0.6) spawn("train","ðŸš†",l);

  setTimeout(spawnLoop,700);
}

function spawn(type,emoji,lane,power){
  let el=document.createElement("div");
  el.className="item";
  el.innerText=emoji;
  el.style.left=(lane*33.33+16)+"%";
  el.style.bottom="100%";
  document.getElementById("game").appendChild(el);
  items.push({el,type,lane,y:window.innerHeight,power,emoji});
}

/* ======= POWER ======= */
function activatePower(p,emoji){
  powerTimer=600;
  powerText.innerText="10";
  player.classList.add("hidden");
  avatar.classList.remove("hidden");
  avatar.innerText=emoji;

  if(p==="magnet") magnet=true;
  if(p==="jetpack") jetpack=true;
  if(p==="double") doubleMoney=true;
}

/* ======= INSTALL AFTER 2 MIN ======= */
function startInstallTimer(){
  setTimeout(()=>{
    if(!installPromptShown && gameState==="playing" && deferredPrompt){
      document.getElementById("installBanner").style.display="block";
      installPromptShown=true;
    }
  }, 120000); // 2 mins
}

document.getElementById("installBtn").addEventListener("click", async ()=>{
  if(deferredPrompt){
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt=null;
    document.getElementById("installBanner").style.display="none";
  }
});

/* ======= SERVICE WORKER ======= */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
